
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Logistic Regression on Amazon Food Reviews dataset}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \subsection{Logistic Regression on Amazon Food Reviews
Dataset}\label{logistic-regression-on-amazon-food-reviews-dataset}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{c+c1}{\PYZsh{}importing required Modules}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{import} \PY{n+nn}{sqlite3}
        \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{nltk}
        \PY{k+kn}{import} \PY{n+nn}{string}
        \PY{k+kn}{import} \PY{n+nn}{pickle}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k}{import} \PY{n}{TfidfTransformer}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k}{import} \PY{n}{TfidfVectorizer}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k}{import} \PY{n}{CountVectorizer}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{confusion\PYZus{}matrix}
        \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{metrics}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{accuracy\PYZus{}score}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{roc\PYZus{}curve}\PY{p}{,} \PY{n}{auc}
        \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{stem}\PY{n+nn}{.}\PY{n+nn}{porter} \PY{k}{import} \PY{n}{PorterStemmer}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k}{import} \PY{n}{StandardScaler}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{TimeSeriesSplit}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{precision\PYZus{}score}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{recall\PYZus{}score}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{confusion\PYZus{}matrix}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k}{import} \PY{n}{LogisticRegression}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{GridSearchCV}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{RandomizedSearchCV}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k+kn}{import} \PY{n+nn}{warnings}
        \PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ignore}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{c+c1}{\PYZsh{}getting data }
        \PY{n}{conn} \PY{o}{=} \PY{n}{sqlite3}\PY{o}{.}\PY{n}{connect}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final.sqlite}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{final\PYZus{}amazon} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}sql\PYZus{}query}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+s2}{SELECT *}
        \PY{l+s+s2}{FROM Reviews}
        \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{p}{,} \PY{n}{conn}\PY{p}{)} 
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{k}{def} \PY{n+nf}{cleanpunc}\PY{p}{(}\PY{n}{sentence}\PY{p}{)}\PY{p}{:} 
            \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{    function to clean the word of any punctuation or special characters}
        \PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
            \PY{n}{cleaned} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[?|!|}\PY{l+s+se}{\PYZbs{}\PYZsq{}}\PY{l+s+s1}{|}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{|\PYZsh{}]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{sentence}\PY{p}{)}
            \PY{n}{cleaned} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[.|,|)|(|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{|/]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{cleaned}\PY{p}{)}
            \PY{k}{return}  \PY{n}{cleaned}
        \PY{k}{def} \PY{n+nf}{cleanhtml}\PY{p}{(}\PY{n}{sentence}\PY{p}{)}\PY{p}{:} 
            \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{    function to clean the word of any html\PYZhy{}tags}
        \PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
            \PY{n}{cleanr} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZlt{}.*?\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{cleantext} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{n}{cleanr}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sentence}\PY{p}{)}
            \PY{k}{return} \PY{n}{cleantext}
        \PY{k}{def} \PY{n+nf}{reduce\PYZus{}lengthening}\PY{p}{(}\PY{n}{text}\PY{p}{)}\PY{p}{:}
            \PY{n}{pattern} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{(.)}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{1}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{2,\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{k}{return} \PY{n}{pattern}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{1}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{1}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{c+c1}{\PYZsh{}getting stop words}
        \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{corpus} \PY{k}{import} \PY{n}{stopwords}
        \PY{n}{stop} \PY{o}{=} \PY{n+nb}{set}\PY{p}{(}\PY{n}{stopwords}\PY{o}{.}\PY{n}{words}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n}{stop}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{not}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{stop}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{very}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{c+c1}{\PYZsh{}from autocorrect import spell}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}31}]:} \PY{c+c1}{\PYZsh{}Cleaning sentances}
         \PY{k+kn}{import} \PY{n+nn}{re}
         \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{stem} \PY{k}{import} \PY{n}{WordNetLemmatizer}
         \PY{n}{lem} \PY{o}{=} \PY{n}{WordNetLemmatizer}\PY{p}{(}\PY{p}{)}
         \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{corpus} \PY{k}{import} \PY{n}{stopwords}
         \PY{n}{stop} \PY{o}{=} \PY{n+nb}{set}\PY{p}{(}\PY{n}{stopwords}\PY{o}{.}\PY{n}{words}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{}set of stopwords}
         \PY{n}{i}\PY{o}{=}\PY{l+m+mi}{0}
         \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}clean}\PY{o}{=}\PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{final\PYZus{}amazon}\PY{o}{.}\PY{n}{CleanedTextBow}\PY{o}{.}\PY{n}{values}\PY{p}{:}
             \PY{n}{filtered\PYZus{}sentence}\PY{o}{=}\PY{p}{[}\PY{p}{]}
             \PY{c+c1}{\PYZsh{}sent=cleanhtml(sent)}
             \PY{k}{for} \PY{n}{w} \PY{o+ow}{in} \PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                 \PY{k}{for} \PY{n}{cleaned\PYZus{}words} \PY{o+ow}{in} \PY{n}{cleanpunc}\PY{p}{(}\PY{n}{w}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                     \PY{n}{cleaned\PYZus{}words} \PY{o}{=} \PY{n}{cleaned\PYZus{}words}\PY{o}{.}\PY{n}{strip}\PY{p}{(}\PY{p}{)}
                     \PY{k}{if}\PY{p}{(} \PY{p}{(}\PY{n}{cleaned\PYZus{}words}\PY{o}{.}\PY{n}{isalpha}\PY{p}{(}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZam{}} \PYZbs{}
                         \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{cleaned\PYZus{}words}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                         \PY{n}{tmp} \PY{o}{=} \PY{n}{reduce\PYZus{}lengthening}\PY{p}{(}\PY{n}{cleaned\PYZus{}words}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                         \PY{n}{tmp} \PY{o}{=} \PY{n}{spell}\PY{p}{(}\PY{n}{tmp}\PY{p}{)}
                         \PY{n}{tmp} \PY{o}{=} \PY{n}{lem}\PY{o}{.}\PY{n}{lemmatize}\PY{p}{(}\PY{n}{tmp}\PY{p}{)}
                         \PY{n}{filtered\PYZus{}sentence}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tmp}\PY{p}{)}
                     \PY{k}{else}\PY{p}{:}
                         \PY{k}{continue} 
             \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}clean}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{filtered\PYZus{}sentence}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{c+c1}{\PYZsh{}Cleaning summary text}
        \PY{k+kn}{import} \PY{n+nn}{re}
        \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{stem} \PY{k}{import} \PY{n}{WordNetLemmatizer}
        \PY{n}{lem} \PY{o}{=} \PY{n}{WordNetLemmatizer}\PY{p}{(}\PY{p}{)}
        \PY{n}{i}\PY{o}{=}\PY{l+m+mi}{0}
        \PY{n}{list\PYZus{}of\PYZus{}summary\PYZus{}clean}\PY{o}{=}\PY{p}{[}\PY{p}{]}
        \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{final\PYZus{}amazon}\PY{o}{.}\PY{n}{Summary}\PY{o}{.}\PY{n}{values}\PY{p}{:}
            \PY{n}{filtered\PYZus{}sentence}\PY{o}{=}\PY{p}{[}\PY{p}{]}
            \PY{n}{sent}\PY{o}{=}\PY{n}{cleanhtml}\PY{p}{(}\PY{n}{sent}\PY{p}{)}
            \PY{k}{for} \PY{n}{w} \PY{o+ow}{in} \PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{cleaned\PYZus{}words} \PY{o+ow}{in} \PY{n}{cleanpunc}\PY{p}{(}\PY{n}{w}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                    \PY{k}{if}\PY{p}{(}\PY{n}{cleaned\PYZus{}words}\PY{o}{.}\PY{n}{isalpha}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZam{}} \PYZbs{}
                          \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{cleaned\PYZus{}words}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{:} 
                        \PY{n}{tmp} \PY{o}{=} \PY{n}{reduce\PYZus{}lengthening}\PY{p}{(}\PY{n}{cleaned\PYZus{}words}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                        \PY{n}{tmp} \PY{o}{=} \PY{n}{spell}\PY{p}{(}\PY{n}{tmp}\PY{p}{)}
                        \PY{n}{tmp} \PY{o}{=} \PY{n}{lem}\PY{o}{.}\PY{n}{lemmatize}\PY{p}{(}\PY{n}{tmp}\PY{p}{)}
                        \PY{n}{filtered\PYZus{}sentence}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tmp}\PY{p}{)}
                    \PY{k}{else}\PY{p}{:}
                        \PY{k}{continue} 
            \PY{n}{list\PYZus{}of\PYZus{}summary\PYZus{}clean}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{filtered\PYZus{}sentence}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{c+c1}{\PYZsh{}concatinating summary text and total text}
         \PY{n}{final\PYZus{}amazon}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{=} \PY{n}{list\PYZus{}of\PYZus{}summary\PYZus{}clean}
         \PY{n}{final\PYZus{}amazon}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{final\PYZus{}amazon}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}clean}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{stem}\PY{n+nn}{.}\PY{n+nn}{snowball} \PY{k}{import} \PY{n}{SnowballStemmer}
         \PY{n}{stemmer} \PY{o}{=} \PY{n}{SnowballStemmer}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{english}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
         \PY{n}{final\PYZus{}stem\PYZus{}text} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{final\PYZus{}amazon}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{p}{:}
             \PY{n}{stem\PYZus{}sent} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{k}{for} \PY{n}{w} \PY{o+ow}{in} \PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                 \PY{n}{stem\PYZus{}sent}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{stemmer}\PY{o}{.}\PY{n}{stem}\PY{p}{(}\PY{n}{w}\PY{p}{)}\PY{p}{)}
             \PY{n}{final\PYZus{}stem\PYZus{}text}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{stem\PYZus{}sent}\PY{p}{)}\PY{p}{)}       
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{n}{final\PYZus{}amazon}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CleanedText}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis} \PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{final\PYZus{}amazon}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}stem\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{final\PYZus{}stem\PYZus{}text}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{c+c1}{\PYZsh{} store final table into an SQlLite table for future.}
        \PY{n}{conn} \PY{o}{=} \PY{n}{sqlite3}\PY{o}{.}\PY{n}{connect}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}clean\PYZus{}LR.sqlite}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{c}\PY{o}{=}\PY{n}{conn}\PY{o}{.}\PY{n}{cursor}\PY{p}{(}\PY{p}{)}
        \PY{n}{conn}\PY{o}{.}\PY{n}{text\PYZus{}factory} \PY{o}{=} \PY{n+nb}{str}
        \PY{n}{final\PYZus{}amazon}\PY{o}{.}\PY{n}{to\PYZus{}sql}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Reviews\PYZus{}final}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conn}\PY{p}{,} \PY{n}{flavor}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{schema}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,}
                     \PY{n}{if\PYZus{}exists}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{replace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} 
                            \PY{n}{index\PYZus{}label}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{chunksize}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{conn} \PY{o}{=} \PY{n}{sqlite3}\PY{o}{.}\PY{n}{connect}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}clean\PYZus{}LR.sqlite}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{final\PYZus{}review} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}sql\PYZus{}query}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+s2}{SELECT *}
        \PY{l+s+s2}{FROM Reviews\PYZus{}final}
        \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{p}{,} \PY{n}{conn}\PY{p}{)} 
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{c+c1}{\PYZsh{}SORT by time for TBS}
        \PY{n}{final\PYZus{}review} \PY{o}{=} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
<class 'pandas.core.frame.DataFrame'>
Int64Index: 364171 entries, 23 to 345187
Data columns (total 15 columns):
level\_0                   364171 non-null int64
index                     364171 non-null int64
Id                        364171 non-null int64
ProductId                 364171 non-null object
UserId                    364171 non-null object
ProfileName               364171 non-null object
HelpfulnessNumerator      364171 non-null int64
HelpfulnessDenominator    364171 non-null int64
Score                     364171 non-null object
Time                      364171 non-null int64
Summary                   364171 non-null object
Text                      364171 non-null object
CleanedTextBow            364171 non-null object
final\_text                364171 non-null object
final\_stem\_text           364171 non-null object
dtypes: int64(6), object(9)
memory usage: 44.5+ MB

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{}changing lables to 1 or 0}
        \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{Score} \PY{o}{=} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{Score}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:}
                             \PY{l+m+mi}{1} \PY{k}{if} \PY{n}{x} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{positive}\PY{l+s+s1}{\PYZsq{}} \PY{k}{else} \PY{l+m+mi}{0}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{c+c1}{\PYZsh{}Converting to int8}
        \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{HelpfulnessNumerator} \PY{o}{=} \PY{n}{final\PYZus{}review}\PY{o}{.}\PYZbs{}
                              \PY{n}{HelpfulnessNumerator}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{int8}\PY{p}{)}
        \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{HelpfulnessDenominator} \PY{o}{=} \PY{n}{final\PYZus{}review}\PY{o}{.}\PYZbs{}
                              \PY{n}{HelpfulnessDenominator}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{int8}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{c+c1}{\PYZsh{}Splitting Dataframe for train and test}
        \PY{n}{train\PYZus{}df} \PY{o}{=} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{n+nb}{round}\PY{p}{(}\PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{,}\PY{p}{:}\PY{p}{]}
        \PY{n}{test\PYZus{}df} \PY{o}{=} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{n+nb}{print}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(254920, 15)
(109251, 15)

    \end{Verbatim}

    \subsubsection{Bag of Words:}\label{bag-of-words}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} \PY{c+c1}{\PYZsh{}BoW with cleaned data and without stopwords}
         \PY{c+c1}{\PYZsh{}simple cv for train data}
         \PY{c+c1}{\PYZsh{}wit l2 regularization}
         \PY{n}{scores\PYZus{}train} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{corpus} \PY{k}{import} \PY{n}{stopwords}
         \PY{n}{stop} \PY{o}{=} \PY{n+nb}{set}\PY{p}{(}\PY{n}{stopwords}\PY{o}{.}\PY{n}{words}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{stop}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{not}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{stop}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{very}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}CountVectorizer for BoW}
         \PY{n}{count\PYZus{}vect} \PY{o}{=} \PY{n}{CountVectorizer}\PY{p}{(}\PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{stop}\PY{p}{)}\PY{p}{,}\PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{int8}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{X\PYZus{}test\PYZus{}cv} \PY{o}{=} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{final\PYZus{}counts\PYZus{}train} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}
                 \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0001}\PY{p}{,}\PY{l+m+mf}{0.0005}\PY{p}{,}\PY{l+m+mf}{0.0008}\PY{p}{,}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
0.0001 Train 0.8703290668220842 CV 0.8441864114231916 No of zeros in Weight vec 0
0.0005 Train 0.8983882898836609 CV 0.8818845127883258 No of zeros in Weight vec 0
0.0008 Train 0.9068054964022326 CV 0.892842198859773 No of zeros in Weight vec 0
0.001 Train 0.910599403734505 CV 0.8977718499921544 No of zeros in Weight vec 0
0.005 Train 0.9325334558741117 CV 0.9230477535435954 No of zeros in Weight vec 0
0.01 Train 0.9391910067023829 CV 0.9296903603744966 No of zeros in Weight vec 0
0.1 Train 0.9547981439555266 CV 0.93830744285789 No of zeros in Weight vec 0
1 Train 0.9685671695321781 CV 0.9377320989591506 No of zeros in Weight vec 0
10 Train 0.9744681804936002 CV 0.9345938595114808 No of zeros in Weight vec 0
100 Train 0.9695198493645065 CV 0.9365291071708771 No of zeros in Weight vec 0
1000 Train 0.9747147564502029 CV 0.934306187562111 No of zeros in Weight vec 0

    \end{Verbatim}

    it seems to be, if C is low i.e high regularization strength, training
and test both scores are low and if c is high i.e low regularization
strength, it is somewhat overfitting to the data. from above we can
infer tat arout 0.01 and 0.1 value of C is better for the data.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.008}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.06}\PY{p}{,}\PY{l+m+mf}{0.08}\PY{p}{,}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mf}{0.13}\PY{p}{,}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{l+m+mf}{0.20}\PY{p}{,}\PY{l+m+mf}{0.25}\PY{p}{,}\PY{l+m+mf}{0.28}\PY{p}{,}\PY{l+m+mf}{0.33}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l2 Regularization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l2 Regularization
0.005 Train 0.9325334558741117 CV 0.9230477535435954 No of zeros in Weight vec 0
0.008 Train 0.9371007150702741 CV 0.9278727966943878 No of zeros in Weight vec 0
0.02 Train 0.9444979937683531 CV 0.9337177676656729 No of zeros in Weight vec 0
0.06 Train 0.9516094685167336 CV 0.9373267430304932 No of zeros in Weight vec 0
0.08 Train 0.9533298962139383 CV 0.9380982268947121 No of zeros in Weight vec 0
0.1 Train 0.9547981439555266 CV 0.93830744285789 No of zeros in Weight vec 0
0.13 Train 0.9562271637040192 CV 0.9386604947957529 No of zeros in Weight vec 0
0.18 Train 0.9582277913519087 CV 0.9388697107589309 No of zeros in Weight vec 0
0.2 Train 0.9588778552374975 CV 0.938830482765835 No of zeros in Weight vec 0
0.25 Train 0.9600715070274147 CV 0.9387912547727392 No of zeros in Weight vec 0
0.28 Train 0.9607439869090583 CV 0.9388566347612323 No of zeros in Weight vec 0
0.33 Train 0.9618143507206742 CV 0.9386343428003556 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.008}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.06}\PY{p}{,}\PY{l+m+mf}{0.08}\PY{p}{,}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mf}{0.13}\PY{p}{,}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{l+m+mf}{0.20}\PY{p}{,}\PY{l+m+mf}{0.25}\PY{p}{,}\PY{l+m+mf}{0.28}\PY{p}{,}\PY{l+m+mf}{0.33}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l2 Regularization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{class\PYZus{}weight}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balanced}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l2 Regularization
0.005 Train 0.9107619197059021 CV 0.9005047335111669 No of zeros in Weight vec 0
0.008 Train 0.9157158548340095 CV 0.9043490768345624 No of zeros in Weight vec 0
0.02 Train 0.9236174934433211 CV 0.9106647837229981 No of zeros in Weight vec 0
0.06 Train 0.9323933558987694 CV 0.9157644228254616 No of zeros in Weight vec 0
0.08 Train 0.9345957275111519 CV 0.9167974266436529 No of zeros in Weight vec 0
0.1 Train 0.9365907511600278 CV 0.9177912024687483 No of zeros in Weight vec 0
0.13 Train 0.9383952388424379 CV 0.9186411423191589 No of zeros in Weight vec 0
0.18 Train 0.9411636143552039 CV 0.9198310581097338 No of zeros in Weight vec 0
0.2 Train 0.9418865302279706 CV 0.9199879700821173 No of zeros in Weight vec 0
0.25 Train 0.9436069579251755 CV 0.9204979339923636 No of zeros in Weight vec 0
0.28 Train 0.944481181771312 CV 0.9206417699670485 No of zeros in Weight vec 0
0.33 Train 0.9456748335612293 CV 0.921112505884199 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{c+c1}{\PYZsh{}with l1 regularization}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{with l1 Regularization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,} \PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
with l1 Regularization
0.001 Train 0.8689392750666876 CV 0.8427349756786443 No of zeros in Weight vec 50505
0.01 Train 0.9205072739907197 CV 0.9104424917621214 No of zeros in Weight vec 50241
0.1 Train 0.9435509179350384 CV 0.9358491552905487 No of zeros in Weight vec 48945
1 Train 0.9629351505234135 CV 0.93792823892463 No of zeros in Weight vec 43334
10 Train 0.9828181390240075 CV 0.9250222291960877 No of zeros in Weight vec 33960
100 Train 0.9861525184371568 CV 0.9090041320152727 No of zeros in Weight vec 28292
1000 Train 0.9865840263612113 CV 0.9005962654950572 No of zeros in Weight vec 24702

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.008}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.06}\PY{p}{,}\PY{l+m+mf}{0.08}\PY{p}{,}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mf}{0.13}\PY{p}{,}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{l+m+mf}{0.20}\PY{p}{,}\PY{l+m+mf}{0.25}\PY{p}{,}\PY{l+m+mf}{0.28}\PY{p}{,}\PY{l+m+mf}{0.33}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l1 Regularization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l1 Regularization
0.005 Train 0.9082177041536841 CV 0.8949082064961557 No of zeros in Weight vec 50369
0.008 Train 0.917055210598283 CV 0.9062189445054658 No of zeros in Weight vec 50294
0.02 Train 0.9293671964313734 CV 0.9214001778335688 No of zeros in Weight vec 50042
0.06 Train 0.939336710676739 CV 0.9322271039280297 No of zeros in Weight vec 49460
0.08 Train 0.9417800542467104 CV 0.9342669595690151 No of zeros in Weight vec 49179
0.1 Train 0.9435565219340522 CV 0.9358622312882473 No of zeros in Weight vec 48944
0.13 Train 0.945439465602654 CV 0.937091375071918 No of zeros in Weight vec 48618
0.18 Train 0.9479108291676941 CV 0.9379151629269313 No of zeros in Weight vec 48130
0.2 Train 0.9486169330434198 CV 0.9380197709085203 No of zeros in Weight vec 47942
0.25 Train 0.9502028647642958 CV 0.9381505308855066 No of zeros in Weight vec 47511
0.28 Train 0.9511275246015557 CV 0.9382943668601914 No of zeros in Weight vec 47271
0.33 Train 0.9525173163569524 CV 0.9384382028348763 No of zeros in Weight vec 46943

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.008}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.06}\PY{p}{,}\PY{l+m+mf}{0.08}\PY{p}{,}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mf}{0.13}\PY{p}{,}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{l+m+mf}{0.20}\PY{p}{,}\PY{l+m+mf}{0.25}\PY{p}{,}\PY{l+m+mf}{0.28}\PY{p}{,}\PY{l+m+mf}{0.33}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l1 Regularization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{solver}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{saga}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l1 Regularization
0.005 Train 0.9128466073389971 CV 0.9010408494168105 No of zeros in Weight vec 50365
0.008 Train 0.9209163659187196 CV 0.9106255557299022 No of zeros in Weight vec 50275
0.02 Train 0.9322084239313174 CV 0.924420733301951 No of zeros in Weight vec 49993
0.06 Train 0.9397626146017798 CV 0.9326063078612898 No of zeros in Weight vec 49234
0.08 Train 0.9410010983838066 CV 0.9338616036403578 No of zeros in Weight vec 48910
0.1 Train 0.9418304902378337 CV 0.9344500235367958 No of zeros in Weight vec 48577
0.13 Train 0.9427439420770662 CV 0.935038443433234 No of zeros in Weight vec 48130
0.18 Train 0.9434612539508193 CV 0.9359668392698363 No of zeros in Weight vec 47333
0.2 Train 0.9436798099123535 CV 0.9360714472514253 No of zeros in Weight vec 47121
0.25 Train 0.9441225258344355 CV 0.9364244991892882 No of zeros in Weight vec 46486
0.28 Train 0.9443130618009011 CV 0.9365552591662744 No of zeros in Weight vec 46099
0.33 Train 0.9445652417565175 CV 0.9367906271248496 No of zeros in Weight vec 45512

    \end{Verbatim}

    We can observe from above that, with l1 regularization if regularization
strengt increses i.e C decreses, spaecity is also incesing and for some
regularization strength we are getting similar test scores with l1 and
l2 regularization for this data.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}78}]:} \PY{n}{c} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.008}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.06}\PY{p}{,}\PY{l+m+mf}{0.08}\PY{p}{,}\PY{l+m+mf}{0.1}\PY{p}{,}
               \PY{l+m+mf}{0.13}\PY{p}{,}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{l+m+mf}{0.20}\PY{p}{,}\PY{l+m+mf}{0.25}\PY{p}{,}\PY{l+m+mf}{0.28}\PY{p}{,}\PY{l+m+mf}{0.33}\PY{p}{,}\PY{l+m+mf}{0.45}\PY{p}{,}\PY{l+m+mf}{0.55}\PY{p}{,}\PY{l+m+mf}{0.65}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]} 
         \PY{n}{model\PYZus{}grid\PYZus{}bow} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{CountVectorizer}\PY{p}{(}\PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{stop}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                     \PY{n}{LogisticRegression}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                     \PY{n}{param\PYZus{}grid}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{c}\PY{p}{,}
                                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}bow}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}64}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}grid\PYZus{}bow}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}grid\PYZus{}bow}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}65}]:} \PY{c+c1}{\PYZsh{}top10 cv scores with GridSearch CV}
         \PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}65}]:}    penality     C  Test\_score  Test\_std  Train\_score
         18       l2  0.18    0.937680  0.002622     0.962179
         20       l2  0.20    0.937624  0.002610     0.963065
         22       l2  0.25    0.937602  0.002735     0.964801
         24       l2  0.28    0.937590  0.002624     0.965629
         26       l2  0.33    0.937512  0.002450     0.966780
         28       l2  0.45    0.937305  0.002560     0.969136
         16       l2  0.13    0.937292  0.002779     0.959622
         29       l1  0.45    0.937154  0.002963     0.957555
         30       l2  0.55    0.937063  0.002416     0.970623
         31       l1  0.55    0.937024  0.002801     0.959865
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}66}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}plt.xlim(0,5)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for BoW Representation of text with GridSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}66}]:} <matplotlib.legend.Legend at 0x155086076e80>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_33_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}67}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for BoW Representation of text with GridSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}67}]:} <matplotlib.legend.Legend at 0x15501f564dd8>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_34_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}119}]:} \PY{c+c1}{\PYZsh{}random Search}
          \PY{n}{model\PYZus{}random\PYZus{}bow} \PY{o}{=} \PY{n}{RandomizedSearchCV}\PY{p}{(}
                                  \PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{CountVectorizer}\PY{p}{(}\PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{stop}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                  \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                              \PY{n}{param\PYZus{}distributions}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{uniform}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}
                                      \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}\PY{n}{n\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{,}
                                      \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
          \PY{n}{model\PYZus{}random\PYZus{}bow}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}69}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}random\PYZus{}bow}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}random\PYZus{}bow}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}70}]:} \PY{c+c1}{\PYZsh{}top 10 scores from random Search}
         \PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}70}]:}    penality         C  Test\_score  Test\_std  Train\_score
         25       l2  0.386489    0.937391  0.002487     0.967984
         6        l2  0.383442    0.937361  0.002472     0.967914
         4        l2  0.437587    0.937292  0.002561     0.968928
         16       l2  0.118274    0.937180  0.002852     0.958896
         15       l1  0.520477    0.937149  0.002881     0.959204
         2        l1  0.544883    0.937106  0.002794     0.959777
         11       l1  0.368242    0.937067  0.002758     0.955453
         0        l1  0.548814    0.937059  0.002797     0.959840
         22       l2  0.568434    0.937054  0.002426     0.970869
         8        l1  0.568045    0.937042  0.002765     0.960239
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}71}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}plt.xlim(0,5)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for BoW Representation of text with RandomSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}71}]:} <matplotlib.legend.Legend at 0x15506960c668>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{itemize}
\tightlist
\item
  with Gridsearch and Randomsearch got best scores and for C in 0.4 to 1
  wit la and l2 regularization we are getting maximum similar scores.
\item
  For l1 regularization got best score at C = 0.5204774795512048 and cv
  mean score is 0.937149. and for l2 regularization got best score at
  0.18 and cv mean score is 0.937680.
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}127}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L2 reg}
          \PY{c+c1}{\PYZsh{}CountVectorizer for BoW}
          \PY{n}{count\PYZus{}vect} \PY{o}{=} \PY{n}{CountVectorizer}\PY{p}{(}\PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{stop}\PY{p}{)}\PY{p}{,}\PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{int8}\PY{p}{)}
          \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}
                  \PY{n}{train\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}test}
          \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
          
          \PY{n}{model\PYZus{}l2} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
          \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}Predicting training data}
          \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}coeff}
          \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}Accuracy score}
          \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}predict test cv}
          \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}Accuracy score}
          \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}precision}
          \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}recall}
          \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}confusion matrix}
          \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L2 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mf}{0.18}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L2 Reg Best CV Score
C 0.18
No of Zeros in Weigth Vec 0
Train Score 0.9559822689471207
Test Score 0.938087523226332
Test Precision 0.9520758807588076
Test Recall 0.9740163243578938
Test ConfusionMatrix [[14658  4421]
 [ 2343 87829]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}128}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L1 reg}
          \PY{n}{model\PYZus{}l1} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{0.5204774795512048}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
          \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}Predicting training data}
          \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}coeff}
          \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}Accuracy score}
          \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}predict test cv}
          \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}Accuracy score}
          \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}precision}
          \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}recall}
          \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}confusion matrix}
          \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L1 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mf}{0.5204774795512048}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L1 Reg Best CV Score
C 0.5204774795512048
No of Zeros in Weigth Vec 51928
Train Score 0.9544759140122391
Test Score 0.9373918774198863
Test Precision 0.9522031690905144
Test Recall 0.9729849620724838
Test ConfusionMatrix [[14675  4404]
 [ 2436 87736]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}129}]:} \PY{o}{\PYZpc{}\PYZpc{}}\PY{k}{timeit}
          \PYZsh{}\PYZsh{}Time for Predcting with L1 reg for 109251 instances 
          test\PYZus{}list = model\PYZus{}l1.predict(X\PYZus{}test)
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
8.14 ms ± 20.6 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}130}]:} \PY{o}{\PYZpc{}\PYZpc{}}\PY{k}{timeit}
          \PYZsh{}\PYZsh{}Time for Predcting with L2 reg for 109251 instances
          test\PYZus{}list = model\PYZus{}l2.predict(X\PYZus{}test)
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
9.76 ms ± 17.2 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

    \end{Verbatim}

    L1 and L2 regularization is giving similar test scores and L1
regularization having 51928 zeros in the Weight vector.

    Feature importance

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Perturbation test for Multicollinearity}
         \PY{c+c1}{\PYZsh{}CountVectorizer for BoW}
         \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k}{import} \PY{n}{uniform}
         \PY{n}{count\PYZus{}vect} \PY{o}{=} \PY{n}{CountVectorizer}\PY{p}{(}\PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{stop}\PY{p}{)}\PY{p}{,}\PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float128}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}
                 \PY{n}{train\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         
         \PY{n}{model\PYZus{}l2\PYZus{}bp} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{Weight\PYZus{}bp} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{coef\PYZus{}}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train\PYZus{}bp} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test\PYZus{}bp} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         
         \PY{n}{X\PYZus{}train1} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train1}\PY{p}{[}\PY{n}{X\PYZus{}train1}\PY{o}{!=}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{n}{uniform}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{X\PYZus{}train\PYZus{}ap} \PY{o}{=} \PY{n}{X\PYZus{}train1}\PY{o}{+}\PY{n}{X\PYZus{}train}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test1} \PY{o}{=} \PY{n}{X\PYZus{}test}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}test1}\PY{p}{[}\PY{n}{X\PYZus{}test1}\PY{o}{!=}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{n}{uniform}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{X\PYZus{}test\PYZus{}ap} \PY{o}{=} \PY{n}{X\PYZus{}test1}\PY{o}{+}\PY{n}{X\PYZus{}test}
         
         \PY{n}{model\PYZus{}l2\PYZus{}ap} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{0.18}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}ap}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}ap}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{Weight\PYZus{}ap} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{coef\PYZus{}}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train\PYZus{}ap} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}ap}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test\PYZus{}ap} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score Befor Perturbation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test\PYZus{}bp}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score After Perturbation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test\PYZus{}ap}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Test Score Befor Perturbation 0.938087523226332
Test Score After Perturbation 0.9380509102891507

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{c+c1}{\PYZsh{}Weights before Perturbation}
         \PY{n}{Weight\PYZus{}bp} 
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}13}]:} array([[ 0.11298219, -0.03456884, -0.04168738, {\ldots},  0.00172645,
                  0.0152829 ,  0.0006452 ]])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{c+c1}{\PYZsh{}Weights after Perturbation}
         \PY{n}{Weight\PYZus{}ap}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}14}]:} array([[ 0.11315245, -0.0345072 , -0.04175502, {\ldots},  0.00175178,
                  0.01529657,  0.00064797]])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{c+c1}{\PYZsh{}abs differnce of weights before and after }
         \PY{n}{diff\PYZus{}weight} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{Weight\PYZus{}bp} \PY{o}{=} \PY{n}{Weight\PYZus{}bp}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         \PY{n}{Weight\PYZus{}ap} \PY{o}{=} \PY{n}{Weight\PYZus{}ap}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{Weight\PYZus{}bp}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{diff\PYZus{}weight}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{Weight\PYZus{}bp}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{Weight\PYZus{}ap}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{min}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n+nb}{min}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
max 0.010515558663356295
min 1.0760794589648268e-10
mean 0.0003665796941435793
median 0.00012369827941392103
std 0.0005590585279788438

    \end{Verbatim}

    We can observe not much diffence before and after perturbation, so not
that much Multicollinear, so we can use weights vectors for feature
importance

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}32}]:} \PY{c+c1}{\PYZsh{}feature importance}
         \PY{n}{idx\PYZus{}neg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{argsort}\PY{p}{(}\PY{n}{Weight\PYZus{}bp}\PY{p}{)}
         \PY{n}{idx\PYZus{}pos} \PY{o}{=} \PY{n}{idx\PYZus{}neg}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}33}]:} \PY{n}{features} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{get\PYZus{}feature\PYZus{}names}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{c+c1}{\PYZsh{}top 50 negative features }
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{features}\PY{p}{[}\PY{n}{idx\PYZus{}neg}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{50}\PY{p}{]}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
['disappointing' 'worst' 'yuck' 'mediocre' 'disappointment' 'terrible'
 'awful' 'undrinkable' 'horrible' 'tasteless' 'flavorless' 'sounded'
 'ruined' 'rip' 'overrated' 'threw' 'wheres' 'yuk' 'unacceptable'
 'deceptive' 'disappointed' 'lacking' 'ripoff' 'ick' 'ugh' 'cancelled'
 'bland' 'sorry' 'disgusting' 'died' 'skip' 'overpriced' 'concept' 'beech'
 'unfortunately' 'beware' 'poor' 'worse' 'stale' 'weak' 'unappealing' 'eh'
 'useless' 'overpowered' 'disliked' 'inedible' 'worthless' 'returning'
 'inconsistent' 'theory']

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}36}]:} \PY{c+c1}{\PYZsh{}top 50 positive features }
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{features}\PY{p}{[}\PY{n}{idx\PYZus{}pos}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{50}\PY{p}{]}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
['pleasantly' 'yum' 'excellent' 'delicious' 'hooked' 'yummy' 'skeptical'
 'awesome' 'addicting' 'perfect' 'amazing' 'beat' 'addictive' 'pleased'
 'fantastic' 'best' 'addicted' 'wonderful' 'refreshing' 'delish' 'great'
 'fabulous' 'mm' 'delighted' 'terrific' 'worried' 'highly' 'satisfied'
 'resist' 'worry' 'yay' 'glad' 'heaven' 'smooth' 'complaint' 'thank'
 'disappoint' 'tasty' 'amazed' 'downside' 'outstanding' 'exceptional'
 'unique' 'welcome' 'perfectly' 'dumm' 'hesitate' 'surprisingly' 'happier'
 'happy']

    \end{Verbatim}

    \subsubsection{TF-IDF}\label{tf-idf}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{c+c1}{\PYZsh{}TFIDF with (1,2) gram with cleaned data }
         \PY{c+c1}{\PYZsh{}simple cv for train data}
         \PY{c+c1}{\PYZsh{}tfidf vec }
         \PY{n}{tf\PYZus{}idf\PYZus{}vect} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{X\PYZus{}test\PYZus{}cv} \PY{o}{=} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{final\PYZus{}counts\PYZus{}train} \PY{o}{=} \PY{n}{tf\PYZus{}idf\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}
                 \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{tf\PYZus{}idf\PYZus{}vect}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}54}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0001}\PY{p}{,}\PY{l+m+mf}{0.0005}\PY{p}{,}\PY{l+m+mf}{0.0008}\PY{p}{,}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{tol}\PY{o}{=}\PY{l+m+mf}{0.000001}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
0.0001 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 0
0.0005 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 0
0.0008 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 0
0.001 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 0
0.005 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 0
0.01 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 0
0.1 Train 0.9004897895137971 CV 0.8894685914535279 No of zeros in Weight vec 0
1 Train 0.963534778417879 CV 0.9441654898268738 No of zeros in Weight vec 0
10 Train 0.9975398444329874 CV 0.9546655159788692 No of zeros in Weight vec 0
100 Train 0.9999943960009863 CV 0.9558423557717454 No of zeros in Weight vec 0
1000 Train 0.9999943960009863 CV 0.9560254197395261 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}55}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mf}{1.2}\PY{p}{,}\PY{l+m+mf}{1.8}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
0.5 Train 0.9488130730088992 CV 0.9355353313457817 No of zeros in Weight vec 0
0.8 Train 0.9587993992513058 CV 0.94182488623882 No of zeros in Weight vec 0
1.2 Train 0.9669868418103158 CV 0.9457869135415032 No of zeros in Weight vec 0
1.8 Train 0.9747427764452713 CV 0.9486374810398034 No of zeros in Weight vec 0
2 Train 0.9767097800990787 CV 0.9491866729431455 No of zeros in Weight vec 0
4 Train 0.9883268700544708 CV 0.9522726084000209 No of zeros in Weight vec 0
6 Train 0.9932976171796194 CV 0.9532402322297191 No of zeros in Weight vec 0
8 Train 0.9960940126874538 CV 0.9540901720801297 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0001}\PY{p}{,}\PY{l+m+mf}{0.0005}\PY{p}{,}\PY{l+m+mf}{0.0008}\PY{p}{,}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{with l1 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
with l1 reg
0.0001 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 1826169
0.0005 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 1826169
0.0008 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 1826169
0.001 Train 0.8600121046378696 CV 0.8293451540352529 No of zeros in Weight vec 1826169
0.005 Train 0.860096164623075 CV 0.8294628380145405 No of zeros in Weight vec 1826166
0.01 Train 0.8624722602048822 CV 0.833660233275799 No of zeros in Weight vec 1826159
0.1 Train 0.922070789715541 CV 0.9145352790417909 No of zeros in Weight vec 1825947
1 Train 0.9561262917217727 CV 0.9489905329776662 No of zeros in Weight vec 1824338
10 Train 0.9976855484073435 CV 0.9526910403263769 No of zeros in Weight vec 1810900
100 Train 0.9999943960009863 CV 0.9503112087452272 No of zeros in Weight vec 1804811
1000 Train 0.9999943960009863 CV 0.952337988388514 No of zeros in Weight vec 1792072

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mf}{1.2}\PY{p}{,}\PY{l+m+mf}{1.8}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{with l1 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{final\PYZus{}counts\PYZus{}train}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
with l1 reg
0.5 Train 0.9481181771312008 CV 0.9425702181076416 No of zeros in Weight vec 1825181
0.8 Train 0.9537389881419381 CV 0.9469245253412836 No of zeros in Weight vec 1824677
1.2 Train 0.9580652753805116 CV 0.9505335007061039 No of zeros in Weight vec 1823993
1.8 Train 0.9633050144583175 CV 0.9529264082849521 No of zeros in Weight vec 1822818
2 Train 0.9646667862186457 CV 0.9534102201998013 No of zeros in Weight vec 1822406
4 Train 0.977034812041873 CV 0.9541555520686228 No of zeros in Weight vec 1817877
6 Train 0.9870547622783619 CV 0.9531487002458288 No of zeros in Weight vec 1814281
8 Train 0.9941494250297012 CV 0.9528871802918563 No of zeros in Weight vec 1812251

    \end{Verbatim}

    it seems to be l2 regularization cv scores are good with low
regularization strength but it may overfits the training data.and l1
regulariztion is also giving similar scores as l2 and having maximum
zeros i.e sparcity in weight vector.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{c+c1}{\PYZsh{}grid search cv}
         \PY{n}{c} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0001}\PY{p}{,}\PY{l+m+mf}{0.0005}\PY{p}{,}\PY{l+m+mf}{0.0008}\PY{p}{,}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.005}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{,}\PY{l+m+mi}{1200}\PY{p}{,}\PY{l+m+mi}{1500}\PY{p}{,}\PY{l+m+mi}{2000}\PY{p}{,}\PY{l+m+mi}{2500}\PY{p}{,}\PY{l+m+mi}{5000}\PY{p}{]}
         \PY{n}{c}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mf}{1.2}\PY{p}{,}\PY{l+m+mf}{1.8}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{]}\PY{p}{)}
         \PY{n}{c}\PY{o}{.}\PY{n}{sort}\PY{p}{(}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}tfidf} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                             \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                      \PY{n}{param\PYZus{}grid}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{c}\PY{p}{,}
                                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}tfidf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}30}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}grid\PYZus{}tfidf}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}grid\PYZus{}tfidf}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                       \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{c+c1}{\PYZsh{}top 10 scores for gridsearch}
         \PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}35}]:}    penality       C  Test\_score  Test\_std  Train\_score
         46       l2  5000.0    0.952589  0.003968     0.999992
         44       l2  2500.0    0.952524  0.004036     0.999992
         42       l2  2000.0    0.952412  0.003998     0.999991
         40       l2  1500.0    0.952386  0.004088     0.999991
         38       l2  1200.0    0.952317  0.004116     0.999992
         36       l2  1000.0    0.952244  0.004157     0.999992
         34       l2   100.0    0.951856  0.004494     0.999991
         27       l1     4.0    0.951109  0.003841     0.975831
         29       l1     6.0    0.950992  0.003561     0.986530
         31       l1     8.0    0.950332  0.003694     0.993787
\end{Verbatim}
            
    it seems like l2 reg is somewhats overfits the traindata than the l1.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}36}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}plt.xlim(0,5)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for Tf\PYZhy{}Idf Representation of text with GridSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}36}]:} <matplotlib.legend.Legend at 0x15507ecc8ef0>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_67_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}38}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for Tf\PYZhy{}Idf Representation of text with GridSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}38}]:} <matplotlib.legend.Legend at 0x155070b45a58>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_68_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}87}]:} \PY{c+c1}{\PYZsh{}random Search}
         \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k}{import} \PY{n}{uniform}
         \PY{n}{model\PYZus{}random\PYZus{}tfidf} \PY{o}{=} \PY{n}{RandomizedSearchCV}\PY{p}{(}\PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                             \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                         \PY{n}{param\PYZus{}distributions}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{uniform}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mi}{25}\PY{p}{)}\PY{p}{,}
                                       \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,} \PY{n}{n\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{40}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}random\PYZus{}tfidf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}89}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}random\PYZus{}tfidf}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}random\PYZus{}tfidf}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}90}]:} \PY{c+c1}{\PYZsh{}topscores with random search}
         \PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}90}]:}    penality          C  Test\_score  Test\_std  Train\_score
         2        l1   5.097182    0.951195  0.003519     0.982095
         20       l1   5.475226    0.951152  0.003550     0.983991
         31       l1   5.191613    0.951144  0.003559     0.982574
         26       l2  24.599528    0.951044  0.004904     0.999900
         6        l2  22.814445    0.950997  0.004949     0.999854
         16       l2  22.323668    0.950941  0.004920     0.999839
         37       l1   3.213526    0.950906  0.003933     0.971143
         34       l2  20.536379    0.950867  0.004964     0.999772
         24       l1   6.526549    0.950824  0.003593     0.988665
         29       l2  19.399397    0.950785  0.005013     0.999711
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}91}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}plt.xlim(0,5)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for Tf\PYZhy{}Idf Representation of text with RandomSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}91}]:} <matplotlib.legend.Legend at 0x155023465630>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_72_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    from above cv scores it seems to be C = 5.0971819632421145 with cv mean
score of 0.951195 for l1 and c = 5000 with cv mean score of 0.952589 for
l2 reg are good

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}93}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L2 reg}
         \PY{c+c1}{\PYZsh{}Tfidf}
         \PY{n}{tfidf\PYZus{}vect} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{tfidf\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}
                 \PY{n}{train\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{tfidf\PYZus{}vect}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         
         \PY{n}{model\PYZus{}l2} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{5000}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}precision}
         \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}recall}
         \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}confusion matrix}
         \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L2 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mi}{5000}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L2 Reg Best CV Score
C 5000
No of Zeros in Weigth Vec 0
Train Score 0.9999960772006904
Test Score 0.9574740734638585
Test Precision 0.9672224285995237
Test Recall 0.9817459965399459
Test ConfusionMatrix [[16079  3000]
 [ 1646 88526]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}99}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L1 reg}
         \PY{n}{model\PYZus{}l1} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{5.0971819632421145}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}precision}
         \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}recall}
         \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}confusion matrix}
         \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L1 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mf}{5.0971819632421145}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L1 Reg Best CV Score
C 5.0971819632421145
No of Zeros in Weigth Vec 2294526
Train Score 0.9834457869135415
Test Score 0.9561193947881484
Test Precision 0.9683584578588199
Test Recall 0.9788182584394268
Test ConfusionMatrix [[16195  2884]
 [ 1910 88262]]

    \end{Verbatim}

    Feature importance

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Perturbation test for Multicollinearity}
         \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L2 reg}
         \PY{c+c1}{\PYZsh{}CountVectorizer for BoW}
         \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k}{import} \PY{n}{uniform}
         \PY{n}{count\PYZus{}vect} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}\PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float128}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}
                 \PY{n}{train\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         
         \PY{n}{model\PYZus{}l2\PYZus{}bp} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{5000}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{Weight\PYZus{}bp} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{coef\PYZus{}}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train\PYZus{}bp} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}bp}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test\PYZus{}bp} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         
         \PY{n}{X\PYZus{}train1} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train1}\PY{p}{[}\PY{n}{X\PYZus{}train1}\PY{o}{!=}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{n}{uniform}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{X\PYZus{}train\PYZus{}ap} \PY{o}{=} \PY{n}{X\PYZus{}train1}\PY{o}{+}\PY{n}{X\PYZus{}train}
         \PY{c+c1}{\PYZsh{}test}
         \PY{n}{X\PYZus{}test1} \PY{o}{=} \PY{n}{X\PYZus{}test}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}test1}\PY{p}{[}\PY{n}{X\PYZus{}test1}\PY{o}{!=}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{n}{uniform}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{X\PYZus{}test\PYZus{}ap} \PY{o}{=} \PY{n}{X\PYZus{}test1}\PY{o}{+}\PY{n}{X\PYZus{}test}
         
         \PY{n}{model\PYZus{}l2\PYZus{}ap} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{5000}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}ap}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}ap}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{Weight\PYZus{}ap} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{coef\PYZus{}}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train\PYZus{}ap} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2\PYZus{}ap}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}ap}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test\PYZus{}ap} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score Befor Perturbation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test\PYZus{}bp}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score After Perturbation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test\PYZus{}ap}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Test Score Befor Perturbation 0.9574740734638585
Test Score After Perturbation 0.9575381461039258

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{c+c1}{\PYZsh{}weights before erturbation}
         \PY{n}{Weight\PYZus{}bp}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}16}]:} array([[1.94012741, 1.37505871, 0.0246249 , {\ldots}, 0.00397922, 0.00253746,
                 0.00253746]])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{c+c1}{\PYZsh{}weights after perturbation}
         \PY{n}{Weight\PYZus{}ap}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}17}]:} array([[1.6783679 , 1.06450657, 0.02410681, {\ldots}, 0.00355471, 0.00212132,
                 0.00212132]])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{c+c1}{\PYZsh{}abs differnce of weights before and after }
         \PY{n}{diff\PYZus{}weight} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{Weight\PYZus{}bp} \PY{o}{=} \PY{n}{Weight\PYZus{}bp}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         \PY{n}{Weight\PYZus{}ap} \PY{o}{=} \PY{n}{Weight\PYZus{}ap}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{Weight\PYZus{}bp}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{diff\PYZus{}weight}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{Weight\PYZus{}bp}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{Weight\PYZus{}ap}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{min}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n+nb}{min}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
max 13.522010334506167
min 6.563040082317034e-09
mean 0.015819965071510282
median 0.0055242442050323325
std 0.037071090835323124

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}33}]:} \PY{n}{diff\PYZus{}weight} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}
         \PY{n+nb}{sum}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{o}{\PYZgt{}}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{o}{/}\PY{n+nb}{len}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}33}]:} 0.00030836153484355415
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{o}{\PYZgt{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{/}\PY{n+nb}{len}\PY{p}{(}\PY{n}{diff\PYZus{}weight}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}34}]:} 0.00011173774717645643
\end{Verbatim}
            
    Sum of them are having high differnce but difference \textgreater{} 0.5
are only 0.03083\%. and we may neglect this and consider for feature
importance

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{c+c1}{\PYZsh{}feature importance}
         \PY{n}{idx\PYZus{}neg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{argsort}\PY{p}{(}\PY{n}{Weight\PYZus{}bp}\PY{p}{)}
         \PY{n}{idx\PYZus{}pos} \PY{o}{=} \PY{n}{idx\PYZus{}neg}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}30}]:} \PY{n}{features} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{get\PYZus{}feature\PYZus{}names}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}31}]:} \PY{c+c1}{\PYZsh{}neg features}
         \PY{n}{features}\PY{p}{[}\PY{n}{idx\PYZus{}neg}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{50}\PY{p}{]}\PY{p}{]}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}31}]:} array(['not', 'disappointing', 'not worth', 'two star', 'terrible',
                'worst', 'not good', 'disappointed', 'horrible', 'yuck', 'awful',
                'disappointment', 'not recommend', 'not very', 'not great',
                'wanted like', 'very disappointed', 'not impressed',
                'economical bean', 'doesnt work', 'bland', 'tasteless',
                'not tasty', 'threw', 'nasty', 'worse', 'unfortunately', 'poor',
                'disgusting', 'weak', 'save your', 'stale', 'not buy', 'not happy',
                'least favorite', 'just doesnt', 'flavorless', 'didnt work',
                'gross', 'ruined', 'sorry', 'mediocre', 'not work', 'beware', 'me',
                'return', 'very little', 'dont recommend', 'definitely not', 'bad'],
               dtype='<U82')
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}32}]:} \PY{c+c1}{\PYZsh{}pos features}
         \PY{n}{features}\PY{p}{[}\PY{n}{idx\PYZus{}pos}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{50}\PY{p}{]}\PY{p}{]}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}32}]:} array(['great', 'delicious', 'good', 'excellent', 'best', 'not bad',
                'perfect', 'not disappointed', 'yummy', 'wonderful', 'awesome',
                'amazing', 'tasty', 'not too', 'love this', 'love', 'yum',
                'fantastic', 'favorite', 'highly recommend', 'nice', 'happy',
                'four star', 'not bitter', 'addictive', 'just right', 'just what',
                'pleased', 'better than', 'hooked', 'love these', 'loved',
                'addicted', 'pleasantly', 'refreshing', 'glad', 'you wont',
                'fabulous', 'easy', 'smooth', 'pleasantly surprised',
                'even better', 'heaven', 'beat', 'only complaint', 'fun',
                'skeptical', 'addicting', 'perfectly', 'love them'], dtype='<U82')
\end{Verbatim}
            
    \subsubsection{Word2Vec}\label{word2vec}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{c+c1}{\PYZsh{}importing}
         \PY{k+kn}{from} \PY{n+nn}{gensim}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{Word2Vec}
         \PY{k+kn}{from} \PY{n+nn}{gensim}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{KeyedVectors}
         \PY{k+kn}{import} \PY{n+nn}{pickle}
         \PY{k+kn}{import} \PY{n+nn}{gensim}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{k+kn}{import} \PY{n+nn}{gensim}
         \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{o}{=}\PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{o}{.}\PY{n}{values}\PY{p}{:}
             \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{c+c1}{\PYZsh{}word2vec model with 50 dim vector}
         \PY{n}{w2v\PYZus{}model\PYZus{}50}\PY{o}{=}\PY{n}{gensim}\PY{o}{.}\PY{n}{models}\PY{o}{.}\PY{n}{Word2Vec}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{,}\PY{n}{min\PYZus{}count}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{workers}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}word2vec model with 100 dim vector}
         \PY{n}{w2v\PYZus{}model\PYZus{}100}\PY{o}{=}\PY{n}{gensim}\PY{o}{.}\PY{n}{models}\PY{o}{.}\PY{n}{Word2Vec}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{,}\PY{n}{min\PYZus{}count}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{workers}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}62}]:} \PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{o}{=}\PY{n}{gensim}\PY{o}{.}\PY{n}{models}\PY{o}{.}\PY{n}{Word2Vec}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{,}\PY{n}{min\PYZus{}count}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{300}\PY{p}{,} \PY{n}{workers}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}64}]:} \PY{c+c1}{\PYZsh{}saving to disk}
         \PY{n}{pickle}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}50}\PY{p}{,}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}50.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{pickle}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}100}\PY{p}{,}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}100.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{pickle}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{,}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}300.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{c+c1}{\PYZsh{}loading from disk}
         \PY{n}{w2v\PYZus{}model\PYZus{}100} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}100.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{w2v\PYZus{}model\PYZus{}50} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}50.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{w2v\PYZus{}model\PYZus{}300} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}300.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \subsubsection{Avg Word2Vec}\label{avg-word2vec}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{c+c1}{\PYZsh{} the avg\PYZhy{}w2v for each sentence/review is stored in this list}
         \PY{k}{def} \PY{n+nf}{avg\PYZus{}w2v}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{,}\PY{n}{model}\PY{p}{,}\PY{n}{d}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         \PY{l+s+sd}{    Returns average of word vectors for }
         \PY{l+s+sd}{    each sentance with dimension of model given}
         \PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
             \PY{n}{sent\PYZus{}vectors} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{:} \PY{c+c1}{\PYZsh{} for each review/sentence}
                 \PY{n}{doc} \PY{o}{=} \PY{p}{[}\PY{n}{word} \PY{k}{for} \PY{n}{word} \PY{o+ow}{in} \PY{n}{sent} \PY{k}{if} \PY{n}{word} \PY{o+ow}{in} \PY{n}{model}\PY{o}{.}\PY{n}{wv}\PY{o}{.}\PY{n}{vocab}\PY{p}{]}
                 \PY{k}{if} \PY{n}{doc}\PY{p}{:}
                     \PY{n}{sent\PYZus{}vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{wv}\PY{p}{[}\PY{n}{doc}\PY{p}{]}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{sent\PYZus{}vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{d}\PY{p}{)}
                 \PY{n}{sent\PYZus{}vectors}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent\PYZus{}vec}\PY{p}{)}
             \PY{k}{return} \PY{n}{sent\PYZus{}vectors}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}92}]:} \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}train}\PY{o}{=}\PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{o}{.}\PY{n}{values}\PY{p}{:}
             \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}train}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}93}]:} \PY{c+c1}{\PYZsh{}avg word2vec for }
         \PY{n}{sent\PYZus{}vector\PYZus{}avgw2v\PYZus{}300} \PY{o}{=} \PY{n}{avg\PYZus{}w2v}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}train}\PY{p}{,}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}94}]:} \PY{c+c1}{\PYZsh{}stacking columns}
         \PY{n}{train\PYZus{}avgw2v\PYZus{}300} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{hstack}\PY{p}{(}\PY{p}{(}\PY{n}{sent\PYZus{}vector\PYZus{}avgw2v\PYZus{}300}\PY{p}{,}
                     \PY{n}{train\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         \PY{n}{column} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{)}\PY{p}{)}
         \PY{n}{column}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{train\PYZus{}avgw2v\PYZus{}300}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{n}{column}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}95}]:} \PY{c+c1}{\PYZsh{}CountVectorizer for BoW}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{X\PYZus{}test\PYZus{}cv} \PY{o}{=} \PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{scale} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train\PYZus{}sc} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}96}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{1.5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
0.001 Train 0.9389612427428212 CV 0.9316386840315916 No of zeros in Weight vec 0
0.01 Train 0.9431866579991481 CV 0.9351953554056175 No of zeros in Weight vec 0
0.05 Train 0.9440104458541615 CV 0.9354830273549872 No of zeros in Weight vec 0
1 Train 0.9441897738225998 CV 0.9357053193158638 No of zeros in Weight vec 0
1.5 Train 0.9441897738225998 CV 0.9356660913227679 No of zeros in Weight vec 0
5 Train 0.9441841698235861 CV 0.9357053193158638 No of zeros in Weight vec 0
10 Train 0.9442065858196409 CV 0.9356922433181651 No of zeros in Weight vec 0
100 Train 0.9441841698235861 CV 0.9357445473089597 No of zeros in Weight vec 0
1000 Train 0.9441785658245724 CV 0.9357445473089597 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}97}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{1.5}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mf}{2.5}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mf}{3.5}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mf}{4.5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mf}{5.5}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
1 Train 0.9441897738225998 CV 0.9357053193158638 No of zeros in Weight vec 0
1.5 Train 0.9441897738225998 CV 0.9356660913227679 No of zeros in Weight vec 0
2 Train 0.9441897738225998 CV 0.9356530153250693 No of zeros in Weight vec 0
2.5 Train 0.9441897738225998 CV 0.9356660913227679 No of zeros in Weight vec 0
3 Train 0.9442009818206272 CV 0.9356922433181651 No of zeros in Weight vec 0
3.5 Train 0.9442009818206272 CV 0.9356922433181651 No of zeros in Weight vec 0
4 Train 0.9442009818206272 CV 0.9356922433181651 No of zeros in Weight vec 0
4.5 Train 0.9442009818206272 CV 0.9356922433181651 No of zeros in Weight vec 0
5 Train 0.9441841698235861 CV 0.9357053193158638 No of zeros in Weight vec 0
5.5 Train 0.9442009818206272 CV 0.9356922433181651 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}98}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{20}\PY{p}{,}\PY{l+m+mi}{30}\PY{p}{,}\PY{l+m+mi}{40}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{]}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
0.8 Train 0.9441729618255588 CV 0.9357053193158638 No of zeros in Weight vec 0
15 Train 0.9442065858196409 CV 0.9357053193158638 No of zeros in Weight vec 0
20 Train 0.9441953778216136 CV 0.9357053193158638 No of zeros in Weight vec 0
30 Train 0.9441953778216136 CV 0.9357183953135624 No of zeros in Weight vec 0
40 Train 0.9441953778216136 CV 0.935731471311261 No of zeros in Weight vec 0
50 Train 0.9441841698235861 CV 0.935731471311261 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}100}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{1.5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{with l1 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
              \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
              \PY{c+c1}{\PYZsh{}Predicting training data}
              \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
              \PY{c+c1}{\PYZsh{}coeff}
              \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
              \PY{c+c1}{\PYZsh{}Accuracy score}
              \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
              \PY{c+c1}{\PYZsh{}predict test cv}
              \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
              \PY{c+c1}{\PYZsh{}Accuracy score}
              \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
with l1 reg
0.001 Train 0.9218466297549932 CV 0.9093833359485328 No of zeros in Weight vec 212
0.01 Train 0.9419705902131761 CV 0.9328416758198651 No of zeros in Weight vec 82
0.05 Train 0.9437358499024904 CV 0.9351299754171243 No of zeros in Weight vec 27
1 Train 0.9441897738225998 CV 0.9356530153250693 No of zeros in Weight vec 0
1.5 Train 0.9441953778216136 CV 0.9356399393273707 No of zeros in Weight vec 1
5 Train 0.9441841698235861 CV 0.9357053193158638 No of zeros in Weight vec 0
10 Train 0.9441785658245724 CV 0.9356791673204665 No of zeros in Weight vec 0
100 Train 0.9441897738225998 CV 0.9357053193158638 No of zeros in Weight vec 0
1000 Train 0.9441841698235861 CV 0.9357053193158638 No of zeros in Weight vec 0

    \end{Verbatim}

    We can observe that C between 1 to 10 may give better cv score. and For
this data we can observe that for l1 regularization for regularization
stregth \textless{}1 is not giving any sparse data.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{c+c1}{\PYZsh{}grid Search}
         \PY{n}{c} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{1.3}\PY{p}{,}\PY{l+m+mf}{1.8}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{30}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{70}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
         \PY{n}{c}\PY{o}{.}\PY{n}{sort}\PY{p}{(}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}avgw2v} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                                     \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                      \PY{n}{param\PYZus{}grid}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{c}\PY{p}{,}
                                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}avgw2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}grid\PYZus{}avgw2v}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}grid\PYZus{}avgw2v}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                       \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{c+c1}{\PYZsh{}best scores with grid search}
         \PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}23}]:}    penality       C  Test\_score  Test\_std  Train\_score
         14       l2     4.0    0.938125  0.004009     0.947528
         16       l2     5.0    0.938107  0.004017     0.947526
         21       l1    30.0    0.938103  0.004001     0.947534
         10       l2     1.3    0.938103  0.003968     0.947521
         12       l2     1.8    0.938103  0.003987     0.947544
         20       l2    30.0    0.938099  0.004019     0.947524
         19       l1    10.0    0.938099  0.004021     0.947541
         18       l2    10.0    0.938099  0.004010     0.947523
         24       l2    70.0    0.938099  0.004021     0.947526
         29       l1  1000.0    0.938099  0.004041     0.947535
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for AvgW2V Representation of text with GridSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}25}]:} <matplotlib.legend.Legend at 0x150d30699908>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_110_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{c+c1}{\PYZsh{}random Search}
         \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k}{import} \PY{n}{uniform}
         \PY{n}{model\PYZus{}random\PYZus{}avgw2v} \PY{o}{=} \PY{n}{RandomizedSearchCV}\PY{p}{(}\PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                                 \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{40}\PY{p}{,}
                     \PY{n}{param\PYZus{}distributions}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{uniform}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{,}
                                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}random\PYZus{}avgw2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{n}{train\PYZus{}df\PYZus{}avgw2v\PYZus{}300}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}42}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}random\PYZus{}avgw2v}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}random\PYZus{}avgw2v}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}43}]:} \PY{c+c1}{\PYZsh{}best score wit random search}
         \PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}43}]:}    penality         C  Test\_score  Test\_std  Train\_score
         35       l1  6.430775    0.938120  0.004039     0.947535
         8        l1  6.073376    0.938116  0.004036     0.947536
         33       l2  4.382682    0.938116  0.004014     0.947524
         31       l2  4.327571    0.938116  0.004012     0.947530
         0        l2  2.590684    0.938112  0.004005     0.947532
         18       l2  2.374378    0.938112  0.004005     0.947537
         14       l1  6.050058    0.938112  0.004034     0.947531
         39       l2  4.583649    0.938112  0.004017     0.947524
         37       l2  2.087359    0.938107  0.003996     0.947543
         28       l1  6.312730    0.938107  0.004033     0.947528
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}44}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}plt.xlim(0,5)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for AvgW2V Representation of text with RandomSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}44}]:} <matplotlib.legend.Legend at 0x150d2d0b1d68>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_114_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    From 10 fold CV we can infer that, best cv score for L2 reg is at C = 4
with mean cv score of 0.938125. Best cv score for l1 reg is at C =
6.430775 with cv mean score of 0.938120

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}48}]:} \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}train}\PY{o}{=}\PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{o}{.}\PY{n}{values}\PY{p}{:}
             \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}train}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         \PY{n}{vector\PYZus{}avgw2v\PYZus{}300\PYZus{}train} \PY{o}{=} \PY{n}{avg\PYZus{}w2v}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}train}\PY{p}{,}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{)}
         
         \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}test}\PY{o}{=}\PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{o}{.}\PY{n}{values}\PY{p}{:}
             \PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}test}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         \PY{n}{vector\PYZus{}avgw2v\PYZus{}300\PYZus{}test} \PY{o}{=} \PY{n}{avg\PYZus{}w2v}\PY{p}{(}\PY{n}{list\PYZus{}of\PYZus{}sent\PYZus{}test}\PY{p}{,}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{}stacking columns for train}
         \PY{n}{train\PYZus{}avgw2v\PYZus{}300} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{hstack}\PY{p}{(}\PY{p}{(}\PY{n}{vector\PYZus{}avgw2v\PYZus{}300\PYZus{}train}\PY{p}{,}
                     \PY{n}{train\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         \PY{n}{column} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{)}\PY{p}{)}
         \PY{n}{column}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{train\PYZus{}df\PYZus{}avgw2v}  \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{train\PYZus{}avgw2v\PYZus{}300}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{n}{column}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{}stacking columns for test}
         \PY{n}{test\PYZus{}avgw2v\PYZus{}300} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{hstack}\PY{p}{(}\PY{p}{(}\PY{n}{vector\PYZus{}avgw2v\PYZus{}300\PYZus{}test}\PY{p}{,}
                     \PY{n}{test\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         \PY{n}{column} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{)}\PY{p}{)}
         \PY{n}{column}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{test\PYZus{}df\PYZus{}avgw2v}  \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{test\PYZus{}avgw2v\PYZus{}300}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{n}{column}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{}scaling}
         \PY{n}{scale} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{train\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}50}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L2 reg}
         \PY{n}{model\PYZus{}l2} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}precision}
         \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}recall}
         \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}confusion matrix}
         \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L2 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L2 Reg Best CV Score
C 4
No of Zeros in Weigth Vec 0
Train Score 0.942566295308332
Test Score 0.9299319914691856
Test Precision 0.9389902644038942
Test Recall 0.9786962693519052
Test ConfusionMatrix [[13345  5734]
 [ 1921 88251]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}51}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L1 reg}
         \PY{n}{model\PYZus{}l1} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{6.430775}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}precision}
         \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}recall}
         \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}confusion matrix}
         \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df\PYZus{}avgw2v}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L1 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mf}{6.430775}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L1 Reg Best CV Score
C 6.430775
No of Zeros in Weigth Vec 0
Train Score 0.9425584497097128
Test Score 0.9298221526576416
Test Precision 0.9389170842776129
Test Recall 0.9786408197666682
Test ConfusionMatrix [[13338  5741]
 [ 1926 88246]]

    \end{Verbatim}

    \paragraph{Tf-Idf Weighted Word2Vec}\label{tf-idf-weighted-word2vec}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}49}]:} \PY{k+kn}{import} \PY{n+nn}{gensim}
         \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{o}{=}\PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{o}{.}\PY{n}{values}\PY{p}{:}
             \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}50}]:} \PY{c+c1}{\PYZsh{}tf\PYZhy{}idf}
         \PY{n}{tf\PYZus{}idf\PYZus{}vect} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{final\PYZus{}tf\PYZus{}idf} \PY{o}{=} \PY{n}{tf\PYZus{}idf\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{final\PYZus{}review}\PY{o}{.}\PY{n}{final\PYZus{}text}\PY{o}{.}\PY{n}{values}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{base} \PY{k}{import} \PY{n}{BaseEstimator}\PY{p}{,} \PY{n}{TransformerMixin}
         
         \PY{k}{class} \PY{n+nc}{TfidfWeightedWord2Vec}\PY{p}{(}\PY{n}{BaseEstimator}\PY{p}{,} \PY{n}{TransformerMixin}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         \PY{l+s+sd}{    Class for Tfidf Weighted Word2Vec Calculations}
         \PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
             \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{word2vec}\PY{p}{)}\PY{p}{:}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{word2vec} \PY{o}{=} \PY{n}{word2vec}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{word2weight} \PY{o}{=} \PY{k+kc}{None}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dim} \PY{o}{=} \PY{n}{word2vec}\PY{o}{.}\PY{n}{vector\PYZus{}size}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tfidf} \PY{o}{=} \PY{k+kc}{None}
         
             \PY{k}{def} \PY{n+nf}{fit}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                 \PY{n}{tfidf} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{p}{)}
                 \PY{n}{tfidf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tfidf} \PY{o}{=} \PY{n}{tfidf}
                 \PY{c+c1}{\PYZsh{}print(self.word2vec.wv.vocab.keys())}
                 \PY{k}{return} \PY{n+nb+bp}{self}
             
             \PY{k}{def} \PY{n+nf}{tf\PYZus{}idf\PYZus{}W2V}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{feature\PYZus{}names}\PY{p}{,}\PY{n}{tf\PYZus{}idf\PYZus{}trans\PYZus{}arr}\PY{p}{,}\PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{)}\PY{p}{:}
                 \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         \PY{l+s+sd}{        tfidf weighted word2vec calculation}
         \PY{l+s+sd}{        \PYZsq{}\PYZsq{}\PYZsq{}}
                 \PY{k+kn}{import} \PY{n+nn}{operator}
                 \PY{n}{dict\PYZus{}tfidf} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{k}\PY{p}{:} \PY{n}{v} \PY{k}{for} \PY{n}{v}\PY{p}{,} \PY{n}{k} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{feature\PYZus{}names}\PY{p}{)}\PY{p}{\PYZcb{}}
                 \PY{n}{sent\PYZus{}vectors} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{n}{i} \PY{o}{=} \PY{l+m+mi}{0}
                 \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{:} \PY{c+c1}{\PYZsh{} for each review/sentence}
                     \PY{n}{doc} \PY{o}{=} \PY{p}{[}\PY{n}{word} \PY{k}{for} \PY{n}{word} \PY{o+ow}{in} \PY{n}{sent} \PY{k}{if} \PY{n}{word} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{word2vec}\PY{o}{.}\PY{n}{wv}\PY{o}{.}\PY{n}{vocab}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{]}
                     \PY{k}{if} \PY{n}{doc}\PY{p}{:}
                         \PY{c+c1}{\PYZsh{}itemgetter}
                         \PY{n}{f} \PY{o}{=} \PY{n}{operator}\PY{o}{.}\PY{n}{itemgetter}\PY{p}{(}\PY{o}{*}\PY{n}{doc}\PY{p}{)}
                         \PY{k}{try}\PY{p}{:}
                             \PY{c+c1}{\PYZsh{}itemgetter from dict}
                             \PY{n}{final} \PY{o}{=} \PY{n}{f}\PY{p}{(}\PY{n}{dict\PYZus{}tfidf}\PY{p}{)}
                             \PY{n}{final} \PY{o}{=} \PY{n}{tf\PYZus{}idf\PYZus{}trans\PYZus{}arr}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{n}{final}\PY{p}{]}
                             \PY{c+c1}{\PYZsh{}converting to dense}
                             \PY{n}{final} \PY{o}{=} \PY{n}{final}\PY{o}{.}\PY{n}{toarray}\PY{p}{(}\PY{p}{)}
                             \PY{c+c1}{\PYZsh{}converting to diagnol matrix for multiplication}
                             \PY{n}{final}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diag}\PY{p}{(}\PY{n}{final}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
                             \PY{n}{sent\PYZus{}vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{final}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{word2vec}\PY{o}{.}\PY{n}{wv}\PY{p}{[}\PY{n}{doc}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                             \PY{c+c1}{\PYZsh{}tfidf weighted word to vec}
                             \PY{n}{sent\PYZus{}vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{sent\PYZus{}vec}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{final}\PY{p}{)}
                         \PY{k}{except}\PY{p}{:}
                             \PY{n}{sent\PYZus{}vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dim}\PY{p}{)}             
                     \PY{k}{else}\PY{p}{:}
                         \PY{n}{sent\PYZus{}vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dim}\PY{p}{)}
                     \PY{n}{sent\PYZus{}vectors}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent\PYZus{}vec}\PY{p}{)}
                     \PY{n}{i} \PY{o}{=} \PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}
                 \PY{k}{return} \PY{n}{sent\PYZus{}vectors}
         
             \PY{k}{def} \PY{n+nf}{transform}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{)}\PY{p}{:}
                 \PY{c+c1}{\PYZsh{}transform data}
                 \PY{n}{tf\PYZus{}idf\PYZus{}trans\PYZus{}arr} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tfidf}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
                 \PY{n}{feature\PYZus{}names} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tfidf}\PY{o}{.}\PY{n}{get\PYZus{}feature\PYZus{}names}\PY{p}{(}\PY{p}{)}
                 \PY{n}{list\PYZus{}of\PYZus{}sent} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{k}{for} \PY{n}{sent} \PY{o+ow}{in} \PY{n}{X}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{:}
                     \PY{n}{list\PYZus{}of\PYZus{}sent}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sent}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                 \PY{n}{temp\PYZus{}vec} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tf\PYZus{}idf\PYZus{}W2V}\PY{p}{(}\PY{n}{feature\PYZus{}names}\PY{p}{,}\PY{n}{tf\PYZus{}idf\PYZus{}trans\PYZus{}arr}\PY{p}{,}\PY{n}{list\PYZus{}of\PYZus{}sent}\PY{p}{)}
                 \PY{n}{temp\PYZus{}vec}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{hstack}\PY{p}{(}\PY{p}{(}\PY{n}{temp\PYZus{}vec}\PY{p}{,}\PY{n}{X}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                 \PY{k}{return} \PY{n}{temp\PYZus{}vec}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}55}]:} \PY{c+c1}{\PYZsh{}instance of class above for testing}
         \PY{n}{tfidfvect\PYZus{}w2v} \PY{o}{=} \PY{n}{TfidfWeightedWord2Vec}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}56}]:} \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{final\PYZus{}review}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}56}]:} TfidfWeightedWord2Vec(word2vec=<gensim.models.word2vec.Word2Vec object at 0x150ca3b8de80>)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}57}]:} \PY{n}{x\PYZus{}trans} \PY{o}{=} \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{final\PYZus{}review}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}60}]:} \PY{n+nb}{len}\PY{p}{(}\PY{n}{x\PYZus{}trans}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}60}]:} 302
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{c+c1}{\PYZsh{} For simple cv}
         \PY{c+c1}{\PYZsh{}Train data}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{n}{X\PYZus{}test\PYZus{}cv} \PY{o}{=} \PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.70}\PY{p}{)}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}
         \PY{c+c1}{\PYZsh{}transforming to tfidf weighted word2vec}
         \PY{n}{tfidfvect\PYZus{}w2v} \PY{o}{=} \PY{n}{TfidfWeightedWord2Vec}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{)}
         \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{n}{X\PYZus{}train\PYZus{}tfw2v} \PY{o}{=} \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{n}{X\PYZus{}cv\PYZus{}tfw2v} \PY{o}{=} \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{c+c1}{\PYZsh{}scaling the data}
         \PY{n}{scale} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train\PYZus{}sc} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}tfw2v}\PY{p}{)}
         \PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}cv\PYZus{}tfw2v}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}69}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{1.5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l2 reg
0.001 Train 0.9189773822599807 CV 0.9030153250693028 No of zeros in Weight vec 0
0.01 Train 0.9249736612046356 CV 0.9083895601234374 No of zeros in Weight vec 0
0.05 Train 0.926425096949183 CV 0.9091218159945604 No of zeros in Weight vec 0
1 Train 0.9266996929008541 CV 0.9094356399393274 No of zeros in Weight vec 0
1.5 Train 0.9267052968998677 CV 0.9094356399393274 No of zeros in Weight vec 0
5 Train 0.9267277128959225 CV 0.9094617919347247 No of zeros in Weight vec 0
10 Train 0.9267221088969089 CV 0.9094617919347247 No of zeros in Weight vec 0
100 Train 0.9267221088969089 CV 0.9094748679324233 No of zeros in Weight vec 0
1000 Train 0.9267221088969089 CV 0.9094748679324233 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}70}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{20}\PY{p}{,}\PY{l+m+mi}{30}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{70}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{500}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l2 reg
3 Train 0.9267277128959225 CV 0.9094617919347247 No of zeros in Weight vec 0
5 Train 0.9267277128959225 CV 0.9094617919347247 No of zeros in Weight vec 0
10 Train 0.9267221088969089 CV 0.9094617919347247 No of zeros in Weight vec 0
20 Train 0.9267221088969089 CV 0.9094617919347247 No of zeros in Weight vec 0
30 Train 0.9267277128959225 CV 0.9094748679324233 No of zeros in Weight vec 0
50 Train 0.9267221088969089 CV 0.9094748679324233 No of zeros in Weight vec 0
70 Train 0.9267277128959225 CV 0.9094748679324233 No of zeros in Weight vec 0
100 Train 0.9267221088969089 CV 0.9094748679324233 No of zeros in Weight vec 0
500 Train 0.9267277128959225 CV 0.9094748679324233 No of zeros in Weight vec 0
1000 Train 0.9267221088969089 CV 0.9094748679324233 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{1.5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l1 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l1 reg
0.001 Train 0.9049561767277129 CV 0.8835320884983524 No of zeros in Weight vec 211
0.01 Train 0.9241498733496223 CV 0.906454312464041 No of zeros in Weight vec 85
0.05 Train 0.9263634529600323 CV 0.9091479679899577 No of zeros in Weight vec 19
1 Train 0.9266604649077582 CV 0.9093702599508342 No of zeros in Weight vec 2
1.5 Train 0.9266884849028266 CV 0.9093964119462314 No of zeros in Weight vec 2
5 Train 0.926682880903813 CV 0.9094225639416288 No of zeros in Weight vec 0
10 Train 0.9266996929008541 CV 0.9094225639416288 No of zeros in Weight vec 0
100 Train 0.9267165048978951 CV 0.909448715937026 No of zeros in Weight vec 0
1000 Train 0.9267277128959225 CV 0.9094617919347247 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{n}{inv\PYZus{}lamda} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{20}\PY{p}{,}\PY{l+m+mi}{30}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{70}\PY{p}{,}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{500}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{With l1 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{inv\PYZus{}lamda}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{n}{c}\PY{p}{,}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{,}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Predicting training data}
             \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}coeff}
             \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}predict test cv}
             \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv\PYZus{}sc}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}Accuracy score}
             \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}cv}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{c} \PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}train}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of zeros in Weight vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
With l1 reg
0.5 Train 0.9266156329156486 CV 0.9093179559600397 No of zeros in Weight vec 3
0.8 Train 0.9266380489117034 CV 0.9093310319577383 No of zeros in Weight vec 2
3 Train 0.926682880903813 CV 0.9094094879439302 No of zeros in Weight vec 0
5 Train 0.926682880903813 CV 0.9094225639416288 No of zeros in Weight vec 0
10 Train 0.9267052968998677 CV 0.9094225639416288 No of zeros in Weight vec 0
20 Train 0.9267052968998677 CV 0.9094356399393274 No of zeros in Weight vec 0
30 Train 0.9267052968998677 CV 0.9094356399393274 No of zeros in Weight vec 0
50 Train 0.9267052968998677 CV 0.909448715937026 No of zeros in Weight vec 0
70 Train 0.9267221088969089 CV 0.909448715937026 No of zeros in Weight vec 0
100 Train 0.9267052968998677 CV 0.909448715937026 No of zeros in Weight vec 0
500 Train 0.9267165048978951 CV 0.9094356399393274 No of zeros in Weight vec 0
1000 Train 0.9267109008988814 CV 0.909448715937026 No of zeros in Weight vec 0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}52}]:} \PY{n}{c} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{,}\PY{l+m+mi}{2500}\PY{p}{]}
         \PY{n}{c}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.8}\PY{p}{,}\PY{l+m+mf}{1.3}\PY{p}{,}\PY{l+m+mf}{1.8}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{]}\PY{p}{)}
         \PY{n}{c}\PY{o}{.}\PY{n}{sort}\PY{p}{(}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}tfidfw2v} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{TfidfWeightedWord2Vec}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{)}\PY{p}{,}
                                 \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                 \PY{n}{param\PYZus{}grid}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{c}\PY{p}{,}
                                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}grid\PYZus{}tfidfw2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                           \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}55}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}grid\PYZus{}tfidfw2v}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}grid\PYZus{}tfidfw2v}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                       \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df}\PY{p}{[}\PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}62}]:} \PY{c+c1}{\PYZsh{}top scores}
         \PY{n}{scores\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}62}]:}    penality       C  Test\_score  Test\_std  Train\_score
         14       l2     4.0    0.914779  0.006225     0.931710
         20       l2    10.0    0.914779  0.006234     0.931718
         18       l2     8.0    0.914779  0.006234     0.931717
         16       l2     6.0    0.914775  0.006225     0.931712
         26       l2  2500.0    0.914771  0.006217     0.931728
         24       l2  1000.0    0.914771  0.006217     0.931729
         22       l2   100.0    0.914771  0.006217     0.931728
         25       l1  1000.0    0.914767  0.006228     0.931708
         23       l1   100.0    0.914767  0.006228     0.931712
         21       l1    10.0    0.914762  0.006211     0.931701
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}63}]:} \PY{c+c1}{\PYZsh{}best scores with l1 reg}
         \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}63}]:}    penality       C  Test\_score  Test\_std  Train\_score
         23       l1   100.0    0.914767  0.006228     0.931712
         25       l1  1000.0    0.914767  0.006228     0.931708
         21       l1    10.0    0.914762  0.006211     0.931701
         27       l1  2500.0    0.914762  0.006219     0.931708
         5        l1     0.5    0.914758  0.006326     0.931644
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}59}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for Tf\PYZhy{}IdfW2v Representation of text with GridSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}59}]:} <matplotlib.legend.Legend at 0x1543d9960b00>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_137_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{n}{model\PYZus{}random\PYZus{}tfidfw2v} \PY{o}{=} \PY{n}{RandomizedSearchCV}\PY{p}{(}
                        \PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{TfidfWeightedWord2Vec}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{)}\PY{p}{,}\PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                         \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                         \PY{n}{param\PYZus{}distributions}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{uniform}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{,}
                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}\PY{n}{n\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,}
                                     \PY{n}{cv}\PY{o}{=}\PY{n}{TimeSeriesSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}random\PYZus{}tfidfw2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{n}{dict\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{idx} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{model\PYZus{}random\PYZus{}tfidfw2v}\PY{o}{.}\PY{n}{grid\PYZus{}scores\PYZus{}}\PY{p}{:}
             \PY{n}{dict\PYZus{}score} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}penalty}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logisticregression\PYZus{}\PYZus{}C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{i}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{dict\PYZus{}score}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model\PYZus{}random\PYZus{}tfidfw2v}\PY{o}{.}\PY{n}{cv\PYZus{}results\PYZus{}}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean\PYZus{}train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             \PY{n}{dict\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{dict\PYZus{}score}\PY{p}{)}
             \PY{n}{idx} \PY{o}{=} \PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}
         \PY{n}{scores\PYZus{}df1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{dict\PYZus{}scores}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{penality}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}std}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2} \PY{o}{=} \PY{n}{scores\PYZus{}df1}\PY{p}{[}\PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{penality}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}32}]:} \PY{n}{scores\PYZus{}df1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test\PYZus{}score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}32}]:}   penality         C  Test\_score  Test\_std  Train\_score
         5       l2  3.987496    0.914775  0.006225     0.931711
         4       l1  3.928565    0.914767  0.006225     0.931691
         1       l1  4.062778    0.914762  0.006227     0.931695
         3       l2  3.222559    0.914762  0.006220     0.931706
         7       l1  4.517030    0.914762  0.006215     0.931686
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}30}]:} \PY{c+c1}{\PYZsh{}plotting validation curve}
         \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l1}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l1 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Train\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train with l2 reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{C}\PY{p}{,}
                  \PY{n}{scores\PYZus{}df1\PYZus{}l2}\PY{o}{.}\PY{n}{Test\PYZus{}score}\PY{p}{,}\PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test with l2 Reg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}plt.xlim(0,5)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Curve with differnt C for Tf\PYZhy{}IdfW2V Representation of text with RandomSearch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}30}]:} <matplotlib.legend.Legend at 0x15527b573828>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_141_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Best cv score for l2 reg is at C = 4.0 and mean cv score for 10 fold cv
is 0.914779. Best cv score for l1 reg is at C = 3.987496 and mean cv
score for 10 fold cv is 0.914775

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{n}{w2v\PYZus{}model\PYZus{}300} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w2v\PYZus{}model\PYZus{}nb\PYZus{}300.p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} For simple cv}
         \PY{c+c1}{\PYZsh{}transforming to tfidf weighted word2vec}
         \PY{n}{tfidfvect\PYZus{}w2v} \PY{o}{=} \PY{n}{TfidfWeightedWord2Vec}\PY{p}{(}\PY{n}{w2v\PYZus{}model\PYZus{}300}\PY{p}{)}
         \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{n}{X\PYZus{}train\PYZus{}tfw2v} \PY{o}{=} \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{n}{X\PYZus{}cv\PYZus{}tfw2v} \PY{o}{=} \PY{n}{tfidfvect\PYZus{}w2v}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final\PYZus{}text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessNumerator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HelpfulnessDenominator}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{)}
         \PY{n}{scale} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}tfw2v}\PY{p}{)}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{scale}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}cv\PYZus{}tfw2v}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}40}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L2 reg}
         \PY{n}{model\PYZus{}l2} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l2}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}precision}
         \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}recall}
         \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}confusion matrix}
         \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L2 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L2 Reg Best CV Score
C 4
No of Zeros in Weigth Vec 0
Train Score 0.9233445786913541
Test Score 0.9028933373607564
Test Precision 0.9079191575320693
Test Recall 0.981934525129752
Test ConfusionMatrix [[10099  8980]
 [ 1629 88543]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}41}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}Test scores for L2 reg}
         \PY{n}{model\PYZus{}l1} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{3.987496}\PY{p}{,}\PY{n}{n\PYZus{}jobs}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Predicting training data}
         \PY{n}{train\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}coeff}
         \PY{n}{no\PYZus{}of\PYZus{}zero} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{==}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}train} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{train\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}predict test cv}
         \PY{n}{test\PYZus{}list} \PY{o}{=} \PY{n}{model\PYZus{}l1}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}Accuracy score}
         \PY{n}{score\PYZus{}test} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}precision}
         \PY{n}{test\PYZus{}precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}recall}
         \PY{n}{test\PYZus{}recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}confusion matrix}
         \PY{n}{confusion\PYZus{}matrix\PYZus{}test} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}df}\PY{o}{.}\PY{n}{Score}\PY{p}{,}\PY{n}{test\PYZus{}list}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{L1 Reg Best CV Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}} \PY{p}{,} \PY{l+m+mf}{3.987496}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No of Zeros in Weigth Vec}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{no\PYZus{}of\PYZus{}zero}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{score\PYZus{}train}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{score\PYZus{}test}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Precision}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}precision}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Recall}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{test\PYZus{}recall}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{confusion\PYZus{}matrix\PYZus{}test}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
L1 Reg Best CV Score
C 3.987496
No of Zeros in Weigth Vec 0
Train Score 0.9233406558920446
Test Score 0.9028475711892797
Test Precision 0.9078809753296557
Test Recall 0.9819234352127046
Test ConfusionMatrix [[10095  8984]
 [ 1630 88542]]

    \end{Verbatim}

    \paragraph{Conclusions :}\label{conclusions}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  For BoW representation with l2 reg, got best cv score at C = 0.18 and
  mean cv score is 0.937680.

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9559822689471207}
  \item
    Test Score \texttt{0.938087523226332}
  \item
    Test Precision \texttt{0.9520758807588076}
  \item
    Test Recall \texttt{0.9740163243578938}
  \item
    No of Zeros in Weigth Vec \texttt{0}
  \item
    Test ConfusionMatrix

    \begin{equation}
       \begin{bmatrix}
    & 14658 & 4421 &  \\
    & 2343 & 87829 & 
      \end{bmatrix}
      \end{equation}
  \end{itemize}
\item
  For BoW representation with l1 reg, got best score at C =
  0.5204774795512048 and cv mean score is 0.937149

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9544759140122391}
  \item
    Test Score \texttt{0.9373918774198863}
  \item
    Test Precision \texttt{0.9522031690905144}
  \item
    Test Recall \texttt{0.9729849620724838}
  \item
    No of Zeros in Weigth Vec \texttt{51928}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 14675 & 4404 &  \\
    & 2436 & 87736 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  For Tf-Idf representation with l2 reg, got best score at c = 5000 with
  cv mean score of 0.952589

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9999960772006904}
  \item
    Test Score \texttt{0.9574740734638585}
  \item
    Test Precision \texttt{0.9672224285995237}
  \item
    Test Recall \texttt{0.9817459965399459}
  \item
    No of Zeros in Weigth Vec \texttt{0}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 16079 & 3000 &  \\
    & 1626 & 88526 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  For Tf-Idf representation with l1 reg, got best score at C =
  5.0971819632421145 with cv mean score of 0.951195

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9834457869135415}
  \item
    Test Score \texttt{0.9561193947881484}
  \item
    Test Precision \texttt{0.9683584578588199}
  \item
    Test Recall \texttt{0.9788182584394268}
  \item
    No of Zeros in Weigth Vec \texttt{2294526}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 16195 & 2884 &  \\
    & 1910 & 88262 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  For AvgW2V representation with l2 reg, got best score at C = 4 with
  mean cv score of 0.938125

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.942566295308332}
  \item
    Test Score \texttt{0.9299319914691856}
  \item
    Test Precision \texttt{0.9389902644038942}
  \item
    Test Recall \texttt{0.9786962693519052}
  \item
    No of Zeros in Weigth Vec \texttt{0}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 13345 & 5734 &  \\
    & 1921 & 88251 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  For AvgW2V representation with l1 reg, got best score at C = 6.430775
  with cv mean score of 0.938120

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9425584497097128}
  \item
    Test Score \texttt{0.9298221526576416}
  \item
    Test Precision \texttt{0.9389170842776129}
  \item
    Test Recall \texttt{0.9786408197666682}
  \item
    No of Zeros in Weigth Vec \texttt{0}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 13338 & 5741 &  \\
    & 1926 & 88246 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  For TfIdf-W2V representation with l2 reg, got best score at C = 4.0
  and mean cv score is 0.914779.

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9233445786913541}
  \item
    Test Score \texttt{0.9028933373607564}
  \item
    Test Precision \texttt{0.9079191575320693}
  \item
    Test Recall \texttt{0.981934525129752}
  \item
    No of Zeros in Weigth Vec \texttt{0}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 10099 & 8980 &  \\
    & 1629 & 88543 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  For TfIdf-W2V representation with l1 reg, got best score at C =
  3.987496 and mean cv score is 0.914775

  \begin{itemize}
  \tightlist
  \item
    Train Score \texttt{0.9233406558920446}
  \item
    Test Score \texttt{0.9028475711892797}
  \item
    Test Precision \texttt{0.9078809753296557}
  \item
    Test Recall \texttt{0.9819234352127046}
  \item
    No of Zeros in Weigth Vec \texttt{0}
  \item
    Test ConfusionMatrix

    \begin{equation}
    \begin{bmatrix}
    & 10095 & 8984 &  \\
    & 1630 & 88542 & 
    \end{bmatrix}
    \end{equation}
  \end{itemize}
\item
  best accuracy model is TF-Idf Representation with l1 regularization.
  best Precision model is Tf-Idf Represenataton with L1
  regularization.Best recall model is Tf-Idf Weighted W2V wit l1
  reguarization and Tf-Idf with l2 reg.
\end{enumerate}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
